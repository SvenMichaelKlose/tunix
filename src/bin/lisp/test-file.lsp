(message "Testing OPEN on missing file...")
(and (open "k87sfdasdj9" 'r)
     (error "File \"k87sfdasdj9\" should be missing."))

(message "Testing OPEN file write to \"test.out\"...")
(let o (open "test.out" 'w)
  (or o (message "Cannot open \"test.out\" for writing."))
  (setout o)
  (print message)
  (terpri)
  (setout stdout)
  (close o))

(message "Testing OPEN file read from \"test.out\"...")
(with ((i (open "test.out" 'r))
       (e nil))
  (or i (message "Cannot open \"test.out\" for reading."))
  (setin i)
  (= e (read))
  (setin stdin)
  (close i)
  (or (equal e message)
      (error "Expression read from \"test.out\" does not match MESSAGE: " e)))

(message "Testing READ/PRINT copy...")
(with ((i (open "test.out" 'r))
       (o (open "test2.out" 'w)))
  (or i (message "Cannot open \"test.out\" for reading."))
  (or o (message "Cannot open \"test2.out\" for writing."))
  (setin i)
  (setout o)
  (print (read))
  (setin stdin)
  (setout stdout)
  (close i)
  (close o))
(with ((i (open "test2.out" 'r))
       (e nil))
  (or i (message "Cannot open \"test2.out\" for reading."))
  (setin i)
  (= e (read))
  (setin stdin)
  (close i)
  (or (equal e message)
      (error "Unexpected expression read from \"test2.out\": " e)))
